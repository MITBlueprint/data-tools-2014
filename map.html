<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
    html {
        height: 100%
    }
    body {
        height: 100%;
        margin: 0;
        padding: 0
    }
    #map-canvas {
        height: 100%;
    }
    h2 {
        font-size: 12px;
        margin: 0;
        padding: 0;
    }
    #mapinfo {
        position: absolute;
        bottom: 0;
        right: 0;
    }
    </style>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?libraries=geometry&sensor=false">
    </script>
    <script type="text/javascript" src="highschools.js">
    </script>
    <script type="text/javascript">
    var hsCircle;
    var totalSchools = 0;
    var totalCount = 0;
    var Boston = new google.maps.LatLng(42.358431, -71.059773)

        function initialize() {
            var mapOptions = {
                center: new google.maps.LatLng(39.232253, -96.020508),
                zoom: 5,
                scrollwheel: true,
                minZoom: 5,
                maxZoom: 8
            };

            var map = new google.maps.Map(document.getElementById("map-canvas"),
                mapOptions);

            // google.maps.event.addListener(map, 'zoom_changed', function() {
            //     console.log(hsCircle);
            //     hsCircle.setVisible(false);
            // });

            for (var name in highschools) {

                totalSchools++;
                totalCount+=highschools[name].count;

                var locationColor = 0;

                if (google.maps.geometry.spherical.computeDistanceBetween(Boston, highschools[name].center) < 100000) {
                    locationColor = '#2400e0';
                } else {
                    locationColor = '#FF0000';
                }

                var highschoolOptions = {
                    strokeColor: locationColor,
                    strokeOpacity: 1,
                    strokeWeight: 3,
                    fillColor: locationColor,
                    fillOpacity: 0.5,
                    map: map,
                    clickable: true,
                    center: highschools[name].center,
                    radius: Math.log(highschools[name].count + 1) * (1 / map.getZoom()) * 100000
                };


                hsCircle = new google.maps.Circle(highschoolOptions);
                hsInfo = new google.maps.InfoWindow({ content: name });

            };

            google.maps.event.addListener(hsCircle, 'click', function(){
                hsInfo.setPosition(hsCircle.getCenter());
                hsInfo.open(map);
                });

            var infowindow = new google.maps.InfoWindow({
                content: '<h2>Total Schools</h2>' + totalSchools + '<h2>Total Students</h2>' + totalCount,
                position: new google.maps.LatLng(28.917923, -122.849609)
            });

            infowindow.open(map);

        }

    google.maps.event.addDomListener(window, 'load', initialize);
    // google.maps.event.addListener(map, 'click', function(){

    // });
    </script>
</head>

<body>
    <div id="map-canvas" />
</body>

</html>
